<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Causal survival forest (experimental) — causal_survival_forest • grf</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  
  <script src="../extra.js"></script>

<meta property="og:title" content="Causal survival forest (experimental) — causal_survival_forest" />
<meta property="og:description" content="Trains a causal survival forest that can be used to estimate
conditional average treatment effects tau(X). When the treatment assignment
is unconfounded, we have tau(X) = E[Y(1) - Y(0) | X = x],
where Y is the survival time up to a fixed maximum follow-up time.
Y(1) and Y(0) are potental outcomes corresponding to the two possible
treatment states." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/grf.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/categorical_inputs.html">Categorical inputs</a>
    </li>
    <li>
      <a href="../articles/ci_and_num.trees.html">Confidence intervals and the number of trees</a>
    </li>
    <li>
      <a href="../articles/muhats.html">Estimating conditional means</a>
    </li>
    <li>
      <a href="../articles/diagnostics.html">Evaluating a causal forest fit</a>
    </li>
    <li>
      <a href="../articles/llf.html">Local linear forests</a>
    </li>
    <li>
      <a href="../articles/sample_weighting_examples.html">Sample weighting</a>
    </li>
    <li>
      <a href="../articles/visualize_tree.html">Visualize trees</a>
    </li>
  </ul>
</li>
<li>
  <a href="../REFERENCE.html">Algorithm reference</a>
</li>
<li>
  <a href="../DEVELOPING.html">Developing</a>
</li>
<li>
  <a href="../CHANGELOG.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/grf-labs/grf">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Causal survival forest (experimental)</h1>
    <small class="dont-index">Source: <a href='https://github.com/grf-labs/grf/blob/master/R/causal_survival_forest.R'><code>R/causal_survival_forest.R</code></a></small>
    <div class="hidden name"><code>causal_survival_forest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Trains a causal survival forest that can be used to estimate
conditional average treatment effects tau(X). When the treatment assignment
is unconfounded, we have tau(X) = E[Y(1) - Y(0) | X = x],
where Y is the survival time up to a fixed maximum follow-up time.
Y(1) and Y(0) are potental outcomes corresponding to the two possible
treatment states.</p>
    </div>

    <pre class="usage"><span class='fu'>causal_survival_forest</span>(
  <span class='no'>X</span>,
  <span class='no'>Y</span>,
  <span class='no'>W</span>,
  <span class='no'>D</span>,
  <span class='kw'>W.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>E1.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>E0.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>S.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>C.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>lambda.C.hat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>failure.times</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>num.trees</span> <span class='kw'>=</span> <span class='fl'>2000</span>,
  <span class='kw'>sample.weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>clusters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>equalize.cluster.weights</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sample.fraction</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>mtry</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>X</span>)) + <span class='fl'>20</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>X</span>)),
  <span class='kw'>min.node.size</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>honesty</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>honesty.fraction</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>honesty.prune.leaves</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
  <span class='kw'>imbalance.penalty</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>stabilize.splits</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>ci.group.size</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>tune.parameters</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='kw'>compute.oob.predictions</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>num.threads</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fl'>1</span>, <span class='fl'>0</span>, <span class='no'>.Machine</span>$<span class='no'>integer.max</span>)
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>The covariates.</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>The event time (may be negative).</p></td>
    </tr>
    <tr>
      <th>W</th>
      <td><p>The treatment assignment (must be a binary vector with no NAs).</p></td>
    </tr>
    <tr>
      <th>D</th>
      <td><p>The event type (0: censoring, 1: failure).</p></td>
    </tr>
    <tr>
      <th>W.hat</th>
      <td><p>Estimates of the treatment propensities E[W | Xi]. If W.hat = NULL,
these are estimated using a separate regression forest. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>E1.hat</th>
      <td><p>Estimates of the expected survival time conditional on being treated
E[Y | X = x, W = 1]. If E1.hat is NULL, then this is estimated with an S-learner using
a survival forest.</p></td>
    </tr>
    <tr>
      <th>E0.hat</th>
      <td><p>Estimates of the expected survival time conditional on being a control unit
E[Y | X = x, W = 0]. If E0.hat is NULL, then this is estimated with an S-learner using
a survival forest.</p></td>
    </tr>
    <tr>
      <th>S.hat</th>
      <td><p>Estimates of the conditional survival function S(t, x, w) = P[Y &gt; t | X = x, W = w].
If S.hat is NULL, this is estimated using a survival forest. If provided:
a N*T matrix of survival estimates. The grid should correspond to the T unique events in Y.
Default is NULL.</p></td>
    </tr>
    <tr>
      <th>C.hat</th>
      <td><p>Estimates of the conditional survival function for the censoring process S_C(t, x, w).
If C.hat is NULL, this is estimated using a survival forest. If provided:
a N*T matrix of survival estimates. The grid should correspond to the T unique events in Y.
Default is NULL.</p></td>
    </tr>
    <tr>
      <th>lambda.C.hat</th>
      <td><p>Estimates of the conditional hazard function -d/dt log(S_C(t, x, w)) for the censoring process.
If lambda.C.hat is NULL, this is estimated from C.hat using a forward difference. If provided:
a matrix of same dimensionality has C.hat.
Default is NULL.</p></td>
    </tr>
    <tr>
      <th>failure.times</th>
      <td><p>A vector of event times to fit the survival curves at. If NULL, then all the unique
event times are used. This speeds up forest estimation by constraining the event grid. Observed event
times are rounded down to the last sorted occurance less than or equal to the specified failure time.
The time points should be in increasing order.
Default is NULL.</p></td>
    </tr>
    <tr>
      <th>num.trees</th>
      <td><p>Number of trees grown in the forest. Note: Getting accurate
confidence intervals generally requires more trees than
getting accurate predictions. Default is 2000.</p></td>
    </tr>
    <tr>
      <th>sample.weights</th>
      <td><p>Weights given to each sample in estimation.
If NULL, each observation receives the same weight.
Note: To avoid introducing confounding, weights should be
independent of the potential outcomes given X. Sample weights
are not used in survival spliting. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>clusters</th>
      <td><p>Vector of integers or factors specifying which cluster each observation corresponds to.
Default is NULL (ignored).</p></td>
    </tr>
    <tr>
      <th>equalize.cluster.weights</th>
      <td><p>If FALSE, each unit is given the same weight (so that bigger
clusters get more weight). If TRUE, each cluster is given equal weight in the forest. In this case,
during training, each tree uses the same number of observations from each drawn cluster: If the
smallest cluster has K units, then when we sample a cluster during training, we only give a random
K elements of the cluster to the tree-growing procedure. When estimating average treatment effects,
each observation is given weight 1/cluster size, so that the total weight of each cluster is the
same. Note that, if this argument is FALSE, sample weights may also be directly adjusted via the
sample.weights argument. If this argument is TRUE, sample.weights must be set to NULL. Default is
FALSE.</p></td>
    </tr>
    <tr>
      <th>sample.fraction</th>
      <td><p>Fraction of the data used to build each tree.
Note: If honesty = TRUE, these subsamples will
further be cut by a factor of honesty.fraction. Default is 0.5.</p></td>
    </tr>
    <tr>
      <th>mtry</th>
      <td><p>Number of variables tried for each split. Default is
\(\sqrt p + 20\) where p is the number of variables.</p></td>
    </tr>
    <tr>
      <th>min.node.size</th>
      <td><p>A target for the minimum number of observations in each tree leaf. Note that nodes
with size smaller than min.node.size can occur, as in the original randomForest package.
Default is 5.</p></td>
    </tr>
    <tr>
      <th>honesty</th>
      <td><p>Whether to use honest splitting (i.e., sub-sample splitting). Default is TRUE.
For a detailed description of honesty, honesty.fraction, honesty.prune.leaves, and recommendations for
parameter tuning, see the grf
<a href='https://grf-labs.github.io/grf/REFERENCE.html#honesty-honesty-fraction-honesty-prune-leaves'>algorithm reference</a>.</p></td>
    </tr>
    <tr>
      <th>honesty.fraction</th>
      <td><p>The fraction of data that will be used for determining splits if honesty = TRUE. Corresponds
to set J1 in the notation of the paper. Default is 0.5 (i.e. half of the data is used for
determining splits).</p></td>
    </tr>
    <tr>
      <th>honesty.prune.leaves</th>
      <td><p>If TRUE, prunes the estimation sample tree such that no leaves
are empty. If FALSE, keep the same tree as determined in the splits sample (if an empty leave is encountered, that
tree is skipped and does not contribute to the estimate). Setting this to FALSE may improve performance on
small/marginally powered data, but requires more trees (note: tuning does not adjust the number of trees).
Only applies if honesty is enabled. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>A tuning parameter that controls the maximum imbalance of a split. Default is 0.05
(meaning the count of failures on each side of a split has to be at least 5 % of the total observation count in a node)</p></td>
    </tr>
    <tr>
      <th>imbalance.penalty</th>
      <td><p>A tuning parameter that controls how harshly imbalanced splits are penalized. Default is 0.</p></td>
    </tr>
    <tr>
      <th>stabilize.splits</th>
      <td><p>Whether or not the treatment and censoring status should be taken into account when
determining the imbalance of a split. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>ci.group.size</th>
      <td><p>The forest will grow ci.group.size trees on each subsample.
In order to provide confidence intervals, ci.group.size must
be at least 2. Default is 2.</p></td>
    </tr>
    <tr>
      <th>tune.parameters</th>
      <td><p>(Currently only applies to the regression forest used in W.hat estimation)
A vector of parameter names to tune.
If "all": all tunable parameters are tuned by cross-validation. The following parameters are
tunable: ("sample.fraction", "mtry", "min.node.size", "honesty.fraction",
 "honesty.prune.leaves", "alpha", "imbalance.penalty"). If honesty is FALSE the honesty.* parameters are not tuned.
Default is "none" (no parameters are tuned).</p></td>
    </tr>
    <tr>
      <th>compute.oob.predictions</th>
      <td><p>Whether OOB predictions on training set should be precomputed. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>num.threads</th>
      <td><p>Number of threads used in training. By default, the number of threads is set
to the maximum hardware concurrency.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>The seed of the C++ random number generator.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A trained causal_survival_forest forest object.</p>
    <h2 class="hasAnchor" id="statistical-details"><a class="anchor" href="#statistical-details"></a>Statistical details</h2>

    

<p>An important assumption for identifying the conditional average treatment effect tau(X)
is that there exists a fixed positive constant M such that the probability of observing an
event time past the maximum follow-up time Y.max is at least M (formally, we assume: P(Y
&gt;= Y.max | X) &gt; M).</p>
<p>This means that the individual censoring probabilities (by default estimated using a
survival_forest on D' = 1 - D) should not get too low. This function provides a warning
if these estimates get below 0.2, if they drop all the way down to below 0.05, we emit a
stronger warning that you can not expect causal survival forest to deliver reliable
estimates.</p>
<p>The practical issue is that we can not reliably extrapolate the survival curves
sufficiently far into the future (where most observations will be censored). A workaround
is to re-define the estimand as the treatment effect up to some suitable maximum
follow-up time Y.max. One can do this in practice by thresholding Y before running
causal_survival_forest: D[Y &gt;= Y.max] = 1 and Y[Y &gt;= Y.max] = Y.max. The online vignette on
survival data has more details.</p>
    <h2 class="hasAnchor" id="computational-details"><a class="anchor" href="#computational-details"></a>Computational details</h2>

    

<p>Causal survival forest computes two nuisance components, the estimated survival
and censoring curves (S.hat and C.hat). Recall that the Kaplan-Meier or
Nelson-Aalen estimates of the survival curve is a step function that only
changes at points at which there is an event D = 1 (or D' = 1 - D for the
censoring curve). For very dense event data Y there may not be any accuracy
benefit to fitting these curves on the complete grid compared with the
computational cost, which scales as O(m*n) in each tree node (where
m is the number of events in the node, and n the number of split points).</p>
<p>The suggested resolution to this issue is to round or relabel the event data Y
to a coarser resolution. The argument `failure.times` can be used for this purpose.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Train a standard causal survival forest.</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>3000</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>5</span>
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='no'>n</span> * <span class='no'>p</span>), <span class='no'>n</span>, <span class='no'>p</span>)
<span class='no'>W</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span>(<span class='no'>n</span>, <span class='fl'>1</span>, <span class='fl'>0.5</span>)
<span class='no'>Y.max</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>failure.time</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span>(<span class='no'>n</span>) * <span class='no'>X</span>[, <span class='fl'>1</span>] + <span class='no'>W</span>, <span class='no'>Y.max</span>)
<span class='no'>censor.time</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='no'>n</span>)
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='no'>failure.time</span>, <span class='no'>censor.time</span>)
<span class='no'>D</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span>(<span class='no'>failure.time</span> <span class='kw'>&lt;=</span> <span class='no'>censor.time</span>)
<span class='no'>cs.forest</span> <span class='kw'>&lt;-</span> <span class='fu'>causal_survival_forest</span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>W</span>, <span class='no'>D</span>)

<span class='co'># Predict using the forest.</span>
<span class='no'>X.test</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0.5</span>, <span class='fl'>10</span>, <span class='no'>p</span>)
<span class='no'>X.test</span>[, <span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>, <span class='kw'>length.out</span> <span class='kw'>=</span> <span class='fl'>10</span>)
<span class='no'>cs.pred</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>cs.forest</span>, <span class='no'>X.test</span>, <span class='kw'>estimate.variance</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Plot the estimated CATEs along with 95% confidence bands.</span>
<span class='no'>r.monte.carlo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span>(<span class='fl'>5000</span>)
<span class='no'>cate</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>NA</span>, <span class='fl'>10</span>)
<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>10</span>) {
  <span class='no'>cate</span>[<span class='no'>i</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='no'>r.monte.carlo</span> * <span class='no'>X.test</span>[<span class='no'>i</span>, <span class='fl'>1</span>] + <span class='fl'>1</span>, <span class='no'>Y.max</span>) -
                    <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='no'>r.monte.carlo</span> * <span class='no'>X.test</span>[<span class='no'>i</span>, <span class='fl'>1</span>], <span class='no'>Y.max</span>))
}
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='no'>cate</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>'l'</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>'red'</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='no'>cs.pred</span>$<span class='no'>predictions</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='no'>cs.pred</span>$<span class='no'>predictions</span> + <span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>cs.pred</span>$<span class='no'>variance.estimates</span>), <span class='kw'>lty</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='no'>cs.pred</span>$<span class='no'>predictions</span> - <span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>cs.pred</span>$<span class='no'>variance.estimates</span>), <span class='kw'>lty</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='img'><img src='causal_survival_forest-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Compute the best linear projection on the first covariate.</span>
<span class='fu'><a href='best_linear_projection.html'>best_linear_projection</a></span>(<span class='no'>cs.forest</span>, <span class='no'>X</span>[, <span class='fl'>1</span>])</div><div class='output co'>#&gt; 
#&gt; Best linear projection of the conditional average treatment effect.
#&gt; Confidence intervals are cluster- and heteroskedasticity-robust (HC3):
#&gt; 
#&gt;              Estimate Std. Error t value  Pr(&gt;|t|)    
#&gt; (Intercept)  0.926755   0.011694  79.249 &lt; 2.2e-16 ***
#&gt; A1          -0.659274   0.027039 -24.383 &lt; 2.2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'>
<span class='co'># Train the forest on a less granular grid.</span>
<span class='no'>cs.forest.grid</span> <span class='kw'>&lt;-</span> <span class='fu'>causal_survival_forest</span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>W</span>, <span class='no'>D</span>,
                                         <span class='kw'>failure.times</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='no'>Y</span>), <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>Y</span>), <span class='kw'>length.out</span> <span class='kw'>=</span> <span class='fl'>50</span>))
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='no'>cs.pred</span>$<span class='no'>predictions</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span>(<span class='no'>X.test</span>[, <span class='fl'>1</span>], <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>cs.forest.grid</span>, <span class='no'>X.test</span>)$<span class='no'>predictions</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"blue"</span>)</div><div class='img'><img src='causal_survival_forest-2.png' alt='' width='700' height='433' /></div><div class='input'># }

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Julie Tibshirani, Susan Athey, Stefan Wager.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


